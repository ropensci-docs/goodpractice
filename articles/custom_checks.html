<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Custom Checks • goodpractice</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Custom Checks">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">goodpractice</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.5.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../articles/goodpractice.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/custom_checks.html">Custom Checks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci-review-tools/goodpractice/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Custom Checks</h1>
                        <h4 data-toc-skip class="author">Hannah
Frick</h4>
            
            <h4 data-toc-skip class="date">2025-02-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/goodpractice/blob/master/vignettes/custom_checks.Rmd" class="external-link"><code>vignettes/custom_checks.Rmd</code></a></small>
      <div class="d-none name"><code>custom_checks.Rmd</code></div>
    </div>

    
    
<p>By default, the <code><a href="../reference/gp.html">goodpractice()</a></code> function and its alias
<code><a href="../reference/gp.html">gp()</a></code> run all the checks available in the package (use
<code><a href="../reference/all_checks.html">all_checks()</a></code> to show all checks implemented). In addition,
users can provide their own custom checks.</p>
<div class="section level2">
<h2 id="whats-happening-inside-of-gp">What’s happening inside of <code>gp()</code>?<a class="anchor" aria-label="anchor" href="#whats-happening-inside-of-gp"></a>
</h2>
<p>The <code><a href="../reference/gp.html">gp()</a></code> function essentially carries out two types of
steps:</p>
<ul>
<li>First, it runs preparation steps for the checks, such as calculating
test coverage or cyclomatic complexity.</li>
<li>Then it carries out the checks, e.g., if cyclomatic complexity
exceeds a threshold.</li>
</ul>
<p>The results of the preparation steps and the checks are added to the
return object, also referred to as the state. The print method accesses
the check results and prints the advice for the failed checks - or
praise if none fail.</p>
</div>
<div class="section level2">
<h2 id="writing-custom-checks">Writing custom checks<a class="anchor" aria-label="anchor" href="#writing-custom-checks"></a>
</h2>
<div class="section level3">
<h3 id="checks-without-corresponding-preparation-steps">Checks without corresponding preparation steps<a class="anchor" aria-label="anchor" href="#checks-without-corresponding-preparation-steps"></a>
</h3>
<p>Custom checks can be created with the <code><a href="../reference/customization.html">make_check()</a></code>
function. As inputs it takes a short <code>description</code> of the
check, the <code>check</code> itself, and the <code>gp</code> advice to
be given in case the check fails. To illustrate this, let’s use a
simplified version of the check on <code>T</code> and <code>F</code>
instead of <code>TRUE</code> and <code>FALSE</code>.</p>
<p>The <code>check</code> argument is a function which takes the state
as the input and carries out the check, returning <code>TRUE</code> if
the check was successful. The state includes the path to the source code
of the package and the <code>checkTnF()</code> function of the
<strong>tools</strong> package can be used to check if <code>T</code> or
<code>F</code> was used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/goodpractice/">goodpractice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a simple version of the T/F check</span></span>
<span><span class="va">check_simple_tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/customization.html">make_check</a></span><span class="op">(</span></span>
<span>  </span>
<span>  description <span class="op">=</span> <span class="st">"TRUE and FALSE is used, not T and F"</span>,</span>
<span>  gp <span class="op">=</span> <span class="st">"avoid 'T' and 'F', use 'TRUE' and 'FALSE' instead."</span>,</span>
<span>  check <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/checkTnF.html" class="external-link">checkTnF</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">state</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Additional checks can be used in <code><a href="../reference/gp.html">gp()</a></code> via the
<code>extra_checks</code> argument. This should be a named list of
<code>check</code> objects as returned by the <code><a href="../reference/customization.html">make_check()</a></code>
function. All checks to be carried out, regardless of whether they are
provided by the <strong>goodpractice</strong> package or custom checks,
must be named in the <code>checks</code> argument to
<code><a href="../reference/gp.html">gp()</a></code>.</p>
<p>The check on <code>T</code>/<code>F</code> implemented in the package
gives more helpful advice than this simplified version and returns which
files contain <code>T</code> and <code>F</code> so let’s do a quick
comparison and run both versions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get path to example package</span></span>
<span><span class="va">pkg_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"bad1"</span>, package <span class="op">=</span> <span class="st">"goodpractice"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gp.html">gp</a></span><span class="op">(</span><span class="va">pkg_path</span>, checks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simple_tf"</span>, <span class="st">"truefalse_not_tf"</span><span class="op">)</span>,</span>
<span>   extra_checks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>simple_tf <span class="op">=</span> <span class="va">check_simple_tf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">──</span> <span style="color: #BBBB00;">GP badpackage</span> <span style="color: #BBBB00;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">It is good practice to</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   <span style="color: #BB0000;">✖</span> avoid 'T' and 'F', use 'TRUE' and 'FALSE' instead.</span></span>
<span><span class="co">#&gt;   <span style="color: #BB0000;">✖</span> avoid 'T' and 'F', as they are just variables which are set to the logicals</span></span>
<span><span class="co">#&gt;     'TRUE' and 'FALSE' by default, but are not reserved words and hence can be</span></span>
<span><span class="co">#&gt;     overwritten by the user.  Hence, one should always use 'TRUE' and 'FALSE'</span></span>
<span><span class="co">#&gt;     for the logicals.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     <span style="color: #0000BB;">R/tf.R</span></span></span>
<span><span class="co">#&gt;     <span style="color: #0000BB;">R/tf.R</span></span></span>
<span><span class="co">#&gt;     <span style="color: #0000BB;">R/tf.R</span></span></span>
<span><span class="co">#&gt;     <span style="color: #0000BB;">R/tf.R</span></span></span>
<span><span class="co">#&gt;     <span style="color: #0000BB;">R/tf.R</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">    ... and 4 more lines</span></span></span>
<span><span class="co"><span style="color: #0000BB;">#&gt; </span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">────────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="including-a-preparation-step">Including a preparation step<a class="anchor" aria-label="anchor" href="#including-a-preparation-step"></a>
</h3>
<p>Including a preparation step is optional but can be helpful if
several checks require the same preparations upfront. In the following
example we check for two different fields to be present in the
DESCRIPTION file, the URL field and the BugReports field. Both checks
can be carried out easily building on a preparation step with the <a href="https://cran.r-project.org/package=desc" class="external-link"><strong>desc</strong></a>
package for handling DESCRIPTION files.</p>
<p>The checks are linked to the preparation via the prep name: it
appears as the <code>name</code> argument to <code><a href="../reference/customization.html">make_prep()</a></code>,
as the <code>preps</code> argument to <code><a href="../reference/customization.html">make_check()</a></code> and
finally as the name in the list for the <code>extra_preps</code>
argument to <code><a href="../reference/gp.html">gp()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prep: process DESCRIPTION file</span></span>
<span><span class="va">desc_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">quiet</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">desc</span><span class="fu">::</span><span class="va"><a href="https://desc.r-lib.org/reference/description.html" class="external-link">description</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">prep_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/customization.html">make_prep</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"desc"</span>, func <span class="op">=</span> <span class="va">desc_fun</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check for an URL field</span></span>
<span><span class="va">check_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/customization.html">make_check</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"URL field in DESCRIPTION"</span>,</span>
<span>  preps <span class="op">=</span> <span class="st">"desc"</span>,</span>
<span>  gp <span class="op">=</span> <span class="st">"have a URL field in DESCRIPTION"</span>,</span>
<span>  check <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="va">state</span><span class="op">$</span><span class="va">desc</span><span class="op">$</span><span class="fu">has_fields</span><span class="op">(</span><span class="st">"URL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check for a BugReport field</span></span>
<span><span class="va">check_bugreports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/customization.html">make_check</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"BugReports in DESCRIPTION"</span>,</span>
<span>  preps <span class="op">=</span> <span class="st">"desc"</span>,</span>
<span>  gp <span class="op">=</span> <span class="st">"add a BugReports field to DESCRIPTION"</span>,</span>
<span>  check <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="va">state</span><span class="op">$</span><span class="va">desc</span><span class="op">$</span><span class="fu">has_fields</span><span class="op">(</span><span class="st">'BugReports'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the two checks with their corresponding prep step</span></span>
<span><span class="fu"><a href="../reference/gp.html">gp</a></span><span class="op">(</span><span class="va">pkg_path</span>, checks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"url"</span>, <span class="st">"bugreports"</span><span class="op">)</span>,</span>
<span>   extra_preps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"desc"</span> <span class="op">=</span> <span class="va">prep_desc</span><span class="op">)</span>,</span>
<span>   extra_checks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"url"</span> <span class="op">=</span> <span class="va">check_url</span>, <span class="st">"bugreports"</span> <span class="op">=</span> <span class="va">check_bugreports</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Preparing: desc</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">──</span> <span style="color: #BBBB00;">GP badpackage</span> <span style="color: #BBBB00;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">It is good practice to</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   <span style="color: #BB0000;">✖</span> have a URL field in DESCRIPTION</span></span>
<span><span class="co">#&gt;   <span style="color: #BB0000;">✖</span> add a BugReports field to DESCRIPTION</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">────────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
<p>More examples for using custom checks can be found in the <a href="https://unconf17.ropensci.org/" class="external-link">rOpenSci unconf 2017</a> project
<a href="https://github.com/ropensci-archive/checkers" class="external-link"><strong>checkers</strong></a>
for automated checking of best practices for research compendia.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
